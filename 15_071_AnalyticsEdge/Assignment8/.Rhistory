setwd("/Users/yukako/WorkSpace/LearnMLDM/15_071_AnalyticsEdge/youtube/")
USvideo_raw <- read.csv("data/USvideos.csv", encoding='utf-8')
INvideo_raw <- read.csv("data/INvideos.csv", encoding='utf-8')
JPvideo_raw <- read.csv("data/JPvideos.csv", encoding='utf-8')
USvideo <- USvideo_raw
dim(USvideo)
head(USvideo); str(USvideo);
###############################
# Data Cleaning
###############################
colnames(USvideo)
# 「コメントdisable、評価disable、エラーでremoved」じゃないデータを抽出
USvideo <- subset(USvideo,
!(USvideo[,13]=="True" | USvideo[,14]=="True" | USvideo[,15]=="True"))
dim(USvideo)
head(USvideo)
USvideo[,2] <- as.POSIXct(as.character(USvideo[,2]), format="%y.%d.%m")# as.DateかPOSIXctか
USvideo[,6] <- as.POSIXct(USvideo[,6], format="%Y-%m-%dT%H:%M:%S.000Z")
class(USvideo[,2])
class(USvideo[,6])
class(USvideo$publish_time)
# takes out "\\n"(=改行コード)など
USvideo$description <- gsub("\\\\n", " ", USvideo, 16)
USvideo$description <- gsub("http[^[:blank:]]+", "", USvideo$description)
USvideo$description <- gsub("www[^[:blank:]]+", "", USvideo$description)
USvideo$description <- gsub('[[:digit:]]+', "", USvideo$description)
USvideo$description <- gsub("[[:punct:]]+", "", USvideo$description)
USvideo$description <- gsub("\\s+"," ", USvideo$description)
swtwd("/Users/yukako/WorkSpace/LearnML/15_071_AnalyticsEdge/")
setwd("/Users/yukako/WorkSpace/LearnML/15_071_AnalyticsEdge/")
setwd("/Users/yukako/WorkSpace/LearnML/15_071_AnalyticsEdge/Assignment8/")
his <^ read.csv("Dartboard_historical.csv")
his <- read.csv("Dartboard_historical.csv")
head(his)
split1 = (his$Year <= 2013)
split1
train = his[split1,]
train
split2 = (his$Year > 2013)
test = his[split2,]
plot(train$Year)
table(train$Year)
table(test$Year)
colnames(train)
head(his)
colnames(train$County.Name)
table(train$County.Name)
head(his)
table(train$Season)
table(train$Week)
table(train$Week_)
table(train$Week_Num)
train$Week_Num
7*52
table(train$Week)
train$Week
train$Week_Num
train$Week
plot(train$Week, train$Week_Num)
table(train$Week)
table(train$Week_Num)
head(his)
table(train$County.Name, train$Week)
# pop : denotes the population in week t of county c;
table(train$Population, train$County.Name, train$Week)
# pop : denotes the population in week t of county c;
table(train$Population, train$County.Name)
# pop : denotes the population in week t of county c;
bar.plot(train$Population, train$County.Name)
# pop : denotes the population in week t of county c;
plot(train$Population, train$County.Name)
# pop : denotes the population in week t of county c;
hist(train$Population, train$County.Name)
# pop : denotes the population in week t of county c;
barplot(train$Population, train$County.Name)
# pop : denotes the population in week t of county c;
barplot(train$County.Name, train$Population)
hear(train$Population)
head(train$Population)
# pop : denotes the population in week t of county c;
barplot(train$Population)
table(train$County.Name, train$Week)
table(train$County.Name, train$Week_Num)
# d   : denotes the demand in week t from county c , in dollars;
d = train$Sales
pop = train$Population
# inc : denotes the income per capita in week t of county c in dollars;
inc = train$Income
# t   : denotes the number of weeks elapsed since the start of year 2012;
t = train$Week_Num
train$Season
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(train$Week_Num, train$Season)
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week_Num, season = train$Season)
u = ifelse(train$Week_Num==train$Season, 1, 0)
u
train$Week_Num
train$Week
head(his)
week = train$Week_Num
train$Week_Num
u = ifelse(train$Week_Num==train$Season, 1, 0)
u
table(u)
u = ifelse(train$Week==train$Season, 1, 0)
table(u)
head(his)
table(train$Week, train$Week_Num)
table(his$Week, his$Week_Num)
table(w=his$Week, n=his$Week_Num)
his$Week
table(w=his$Week, n=his$Week_Num)
max.print(table(w=his$Week, n=his$Week_Num))
table(w=his$Week, n=his$Week_Num, "max.print")
options(max.print=１００)
options(max.print=100)
table(w=his$Week, n=his$Week_Num)
options(max.print=99999)
table(w=his$Week, n=his$Week_Num)
7*156
# t   : denotes the number of weeks elapsed since the start of year 2012;
t = train$Week
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week, season = train$Season)
u = ifelse(train$Week==train$Season, 1, 0)
table(u)
# Week_NumとWeekの関係がよくわからなかったので調べてました
# Week_Numは2012年からのカウント、あとで使うのかな？
table(w=his$Week, n=his$Week_Num)
# Week_NumとWeekの関係がよくわからなかったので調べてました
# Week_Numは2012年からのカウント
str(his$Week)
str(his$Week_Num)
# Week_NumとWeekの関係がよくわからなかったので調べてました
# Week_Numは2012年からのカウント
summary(his$Week)
summary(his$Week_Num)
sumarry(train$Week)
summary(train$Week)
summary(train$Week_Num)
table(his$Week)
table(his$Week_Num)
# t   : denotes the number of weeks elapsed since the start of year 2012;
t = train$Week_Num
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week_Num, season = train$Season)
u = ifelse(train$Week_Num==train$Season, 1, 0)
table(his$Week_Num) # 各countryごとに
table(his$Week_Num) # 各country(756個)ごとに1-156週分
table(his$Week)
summary(his$County.Name)
table(his$County.Name)
table(his$Week_Num) # 各country(756個)ごとに1-156週分
table(his$Week_Num) # 各country(756個)ごとに1-156週分
table(w=his$Week, n=his$Week_Num)
head(his)
summary(his$County.Name)
table(train$County.Name, train$Week_Num)
options(max.print=99)
table(train$County.Name, train$Week)
options(max.print=999)
table(train$County.Name, train$Week)
table(train$County.Name, train$Week_Num)
train[104:106,]
train[154:156,]
train[154:159,]
table(his$County.Name)
table(his$County.Name)/52
table(his$Year)
subset(his$County.Name="Wood Country")
subset(his$County.Name=="Wood Country", his)
subset(his$County.Name=="Wood Country")
subset(his, his$County.Name=="Wood Country")
subset(his, his$County.Name=="Wood County")
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week_Num, season = train$Season)
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week_Num, season = train$Season)
t
table(u)
u1 = ifelse(train$Week_Num==1, 1, 0)
u1
table(u)
u2 = ifelse(train$Week_Num==2, 1, 0)
u2
table(u2)
table(u1)
u1 = ifelse(train$Week_Num==1, 1, 0)
u2 = ifelse(train$Week_Num==2, 1, 0)
u3 = ifelse(train$Week_Num==3, 1, 0)
u4 = ifelse(train$Week_Num==4, 1, 0)
u5 = ifelse(train$Week_Num==5, 1, 0)
u6 = ifelse(train$Week_Num==6, 1, 0)
u7 = ifelse(train$Week_Num==7, 1, 0)
u8 = ifelse(train$Week_Num==8, 1, 0)
u9 = ifelse(train$Week_Num==9, 1, 0)
u10 = ifelse(train$Week_Num==10, 1, 0)
u11 = ifelse(train$Week_Num==11, 1, 0)
u12 = ifelse(train$Week_Num==12, 1, 0)
u13 = ifelse(train$Week_Num==13, 1, 0)
table(u1)
table(u13)
# Fit regression model
result = lm(log10(d/pop) ~ log10(inc) + t + u1 )
result
summary(result)
result = lm(log10(d/pop) ~ log10(inc) + t +
u1 + u2 + u3 + u4 + u5 + u6 + u7 + u8 + u9 + u10 + u11 + u12 + u13)
summary(result)
plot(log10(d/pop), log10(inc))
plot(log10(d/pop), log10(inc))
summary(result)
plot(-2.345e-01*log10(inc) + 2.285e-03*t, log10(d/pop))
# uのところもう少しスマートにやったやつ
result2 = lm(log10(d/pop) ~ log10(inc) + t + train$Season)
summary(result2)
# uのところもう少しスマートにやったやつ
library(caret)
?dummyVars
result2 = lm(log10(d/pop) ~ log10(inc) + t + as.factor(train$Season))
summary(result2)
# uのところもう少しスマートにやったやつ
u = as.factor(train$Season)
u
result2 = lm(log10(d/pop) ~ log10(inc) + t + u)
summary(result2)
summary(result)
u
u12
summary(result)
result$coefficients[1]
cof = result$coefficients
cof[1]
cof[2]
plot(cof[0] + cof[1]*log10(inc) + cof[2]*t, log10(d/pop)) # すぎょい
plot(cof[1]*log10(inc) + cof[2]*t, log10(d/pop)) # すぎょい
# ほんとにregressionしてるか、summaryで見た各項の係数を使ってなんとなくたしかめ
plot(-2.345e-01*log10(inc) + 2.285e-03*t, log10(d/pop)) # すぎょい
summary(result)
cof[1]
cof[0]
plot(cof[2]*log10(inc) + cof[3]*t, log10(d/pop)) # すぎょい
plot(cof[2]*log10(inc) + cof[3]*t +
cof[4]*u1 + cof[5]*u2 + cof[6]*u3 + cof[7]*u4
+ cof[8]*u5 + cof[9]*u6 + cof[10]*u7 + cof[11]*u8
+ cof[12]*u9 + cof[13]*u10 + cof[14]*u11 + cof[15]*u12 + cof[16]*u13,
log10(d/pop)) # すぎょい
summary(result)
# オマケ
# ほんとにregressionしてるか、summaryで見た各項の係数を使ってなんとなくたしかめ
# (切片とuはめんどいので省略)
plot(-2.345e-01*log10(inc) + 2.285e-03*t, log10(d/pop)) # すぎょい
# uのところもう少しスマートにやったやつ
table(week = train$Week_Num, season = train$Season)
table(ifelse(train$Week_Num==train$Season, 1, 0))
ifelse(train$Week_Num==train$Season, train$Season, 0)
table(ifelse(train$Week_Num==train$Season, train$Season, 0))
for(i in c(1:13)){
a = ifelse(train$Week_Num==train$Season[i], train$Season[i], 0)
}
a
for(i in c(1:1)){
a = ifelse(train$Week_Num==train$Season[i], train$Season[i], 0)
}
a
# uのところもう少しスマートにやったやつ
data.frame(week = train$Week_Num, season = train$Season)
u = as.factor(train$Season)
result2 = lm(log10(d/pop) ~ log10(inc) + t + u)
summary(result2)
table(u)
table(his$County.Name)/52
summary(his$County.Name)
# -> 異なる州で被ってる名前の群があるからでした。そして以下にはなんも関係なかった
table(his$Week)
table(his$Week_Num)
# -> 異なる州で被ってる名前の群があるからでした。そして以下にはなんも関係なかった
table(w=his$Week, n=his$Week_Num)
# u   : indicates if week t falls in “season” s of the year (=1); otherwise, 0;
table(week = train$Week_Num, season = train$Season) # 2つの個数の関係を見たかった
data.frame(week = train$Week_Num, season = train$Season) # Week_NumとSeasonを並べて見たかった
# もっと明示的にやるなら
library(caret)
dummyVars(~Season, data=train)
dummyVars(~., data=train$Season)
a <- dummyVars(~., data=train$Season)
a
a <- dummyVars(~., data = as.factor(train$Season))
a
a <- dummyVars(~Season, data = as.factor(train$Season))
a <- dummyVars(~., data = as.factor(train$Season))
a
require(dummies)
library(dummies)
install.packages(dummies)
install.packages("dummies")
library(dummies)
dummy.data.frame(train$Season)
dummy.data.frame(as.factor(train$Season)))
dummy.data.frame(as.factor(train$Season))
dummy(as.factor(train$Season))
u_dum = dummy(as.factor(train$Season))
u_dum
table(u_dum)
result2 = lm(log10(d/pop) ~ log10(inc) + t + u_dum)
summary(result2)
summary(result)
summary(result2)
u_dum
u_dum[13]
u_dum[1,13]
sum(u_dum[1,13])
sum(u_dum[,13])
sum(u_dum[,12])
result2 = lm(log10(d/pop) ~ log10(inc) + t + u_dum)
summary(result2)
table(u)
sum(u[1,])
dim(u_dum)
df = data.frame(log10(d/pop), log10(inc), u_dum)
df
result2 = lm(log10(d/pop) ~ ., data = df)
summary(result2)
head(df)
df = data.frame(y=log10(d/pop), x0=log10(inc), x1=t, u_dum)
head(df)
df = data.frame(y=log10(d/pop), log10(inc), t, u_dum)
head(df)
result2 = lm(y ~ ., data = df)
summary(result2)
result2 = lm(log10(d/pop) ~ log10(inc) + t + u_dum)
summary(result2)
dt = data.frame(log10(d/pop), log10(inc), t, u)
head(dt)
head(df)
result = lm(log10(d/pop) ~ log10(inc) + t + u, data = dt)
summary(result)
result = lm(log10(d/pop) ~ log10(inc) + t + u)
summary(result)
dt = data.frame(y=log10(d/pop), log10(inc), t, u)
head(dt)
result = lm(y ~ log10(inc) + t + u, data = dt)
summary(result)
result = lm(log10(d/pop) ~ log10(inc) + t + u)
summary(result)
u_dum
result2 = lm(log10(d/pop) ~ log10(inc) + t + u_dum)
summary(result2)
summary(result)
plot(-0.2350912*log10(inc) + 0.0020721*t, log10(d/pop)) # すぎょい
# オマケ
# ほんとにregressionしてるか、summaryで見た各項の係数を使ってなんとなくたしかめ
# (切片とuはめんどいので省略)
plot(-2.345e-01*log10(inc) + 2.285e-03*t, log10(d/pop)) # すぎょい
summary(result2)
u_dum
c(2,5,6,8,11,12)
b = c(1,2,3,4,5,6)
r = lm(a~b)
a = c(2,5,6,8,11,12)
b = c(1,2,3,4,5,6)
r = lm(a~b)
summary(r)
b1 = c(100,120,140,160,120,200)
r = lm(a~b0+b1)
b0 = c(1,2,3,4,5,6)
r = lm(a~b0+b1)
summary(r)
c = c("jp", "us", "us", "en", "nk", "jp")
r = lm(a ~ b0+b1+c)
summary(r)
c_dum = dummy(b1)
c_dum
c_dum = dummy(c)
c_dum
r = lm(a ~ b0+b1+c)
summary(r)
r = lm(a ~ b0+b1+c_dum)
summary(r)
mode(c)
class(c)
c_fac = as.factor(c)
r = lm(a ~ b0+b1+c_fac)
summary(r)
a <- data.frame()
r = lm(a ~ b0+b1+c)
a = c(2,5,6,8,11,12)
r_dum = lm(a ~ b0+b1+c_dum)
r = lm(a ~ b0+b1+c)
r_dum = lm(a ~ b0+b1+c_dum)
r_fac = lm(a ~ b0+b1+c_fac)
summary(r)
summary(r_dum)
summary(r_fac)
c = c("jp", "us", "us", "en", "nk", "jp")
a = c(2,5,6,8,11,12)
b0 = c(1,2,3,4,5,6)
b1 = c(100,120,140,160,120,200)
c = c("jp", "us", "us", "en", "nk", "jp")
c_dum = dummy(c)
c_fac = as.factor(c)
r = lm(a ~ b0+b1+c)
r_dum = lm(a ~ b0+b1+c_dum)
r_fac = lm(a ~ b0+b1+c_fac)
summary(r)
summary(r_dum)
summary(r_fac)
summary(r)
summary(r_dum)
summary(r)
summary(r_fac)
summary(r)
summary(r_fac)
summary(r_dum)
summary(r_fac)
summary(r_dum)
summary(r_dum)
a <- data.frame()
c_dum
setwd("/Users/yukako/WorkSpace/LearnML/15_071_AnalyticsEdge/Assignment8/")
his <- read.csv("Dartboard_historical.csv")
split1 = (his$Year <= 2013)
split2 = (his$Year > 2013)
train = his[split1,]
test = his[split2,]
head(his)
# d   : denotes the demand in week t from county c , in dollars;
d = train$Sales
# pop : denotes the population in week t of county c;
barplot(train$Population)
pop = train$Population
# inc : denotes the income per capita in week t of county c in dollars;
inc = train$Income
# t   : denotes the number of weeks elapsed since the start of year 2012;
t = train$Week_Num
u = as.date(train$Season)
u = as.Date(train$Season)
u = as.Date(train$Season, origin="1970-01-01")
table(u)
# 式に当てはめる
result = lm(log10(d/pop) ~ log10(inc) + t + u)
summary(result)
